---
title: Network - 캐시
date: 2019-09-29 21:37:31
tags: [HTTP, 캐시, Cache]
---

![images](/images/network/network.jpg)<br/>

**이번 장에서 살펴볼 주제**
- 캐시는 불필요한 데이터 전송을 줄여서, 네트워크 요금으로 인한 비용을 줄여준다.
- 캐시는 네트워크 병목을 줄여준다. 대역폭을 늘리지 않고도 페이지를 빨리 불러올 수 있게 된다.
- 캐시는 원 서버에 대한 요청을 줄여준다. 서버는 부하를 줄일 수 있으며 더 빨리 응답할 수 있게 된다.
- 페이지를 먼 곳에서 불러올수록 시간이 많이 걸리는데 캐시는 거리로 인한 지연을 줄여준다.

<br/>

# 불필요한 데이터 전송 
복수의 클라이언트가 자주 쓰이는 원 서버 페이지에 접근할 때, 서버는 같은 문서를 각각 한 번씩 전송하게 됩니다. 이 떄 똑같은 바이트들이 네트워크를 통해 반복해서 이동하는데 이 불필요한 데이터 전송은 `웹 서버`에 **부하**를 줍니다. 이 때 캐시를 이용하면, 서버 응답은 `캐시`에 보관되며 캐시된 사본이 뒤이은 요청들에 대한 응답으로 사용되기 때문에 낭비가 줄어듭니다.<br/>
<br/>

# 대역폭 방목
캐시는 네트워크 병목을 줄여줍니다. **클라이언트**들이 서버에 접근할 때의 속도는, 그 경로에 있는 **가장 느린** 네트워크의 속도와 같습니다. 이 때 만약 **클라이언트**가 빠른 LAN에 있는 캐시로부터 사본을 가져온다면 성능이 대폭 향상될 것입니다.<br/>
<br/>

# 갑작스런 요청 쇄도
캐싱은 갑작스런 요청 쇄도에 대처하기 위해 특히 중요합니다. 많은 사람들이 동시에 웹 문서에 접근할 때 이런 일이 발생합니다. 이 상황을 막기 위해 캐시를 이용합니다.<br/>
<br/>

# 거리로 인한 지연
대역폭이 문제가 되지 않는 상황이라면, 거리가 문제가 될 수도 있습니다. 기계실 근처에 캐시를 설치해서 문서가 전송되는 거리를 줄이는 방법이 있습니다.<br/>
<br/>

# 적중과 부적중
캐시가 세상 모든 문서의 사본을 저장하지는 않는데, 캐시에 요청이 들어왔을 때 해당하는 사본이 있다면 요청이 처리되어 `캐시 적중`이 되고 만약 해당되는 사본이 없다면 그냥 우너 서버로 전달되는 `캐시 부적중`이 발생합니다.<br/>
<br/>

## 재검사
원 서버 컨텐츠는 변경될 수 있기 떄문에, 캐시는 반드시 그들이 갖고 있는 사본이 여전히 최신인지 서버를 통해 점검해야합니다. 이를 `재검사`라고 합니다. 대부분의 캐시는 클라이언트가 사본을 요청하였으며 그 사본이 검사를 할 필요가 있을 정도로 오래된 경우에만 재검사를 합니다. 이 때 사본이 여전히 유효하면 서버에 `304 Not Modified` 응답을 보내고 클라이언트에게 제공합니다. HTTP는 캐시된 객체를 재확인 하기 위해 몇 가지 **도구**를 제공하는데 그 중에서 가장 많이 쓰이는 것은 `If-Modified-Since` 헤더입니다.<br/>
서버에게 보내는 GET 요청이 이 헤더를 추가하면 캐시된 시간 이후에 **변경된 경우**에만 사본을 보내달라는 의미가 됩니다. 아래는 GET If-Modified-Since 요청이 서버에 도착했을 때 일어나는 세 가지 상황에 대해서 알아보겠습니다.
- 재검사 적중 : 만약 서버 객체가 변경되지 않았다면, 서버는 클라이언트에게 304 Not Modified를 보냅니다.
- 재검사 부적중 : 만약 서버 객체가 캐시된 사본과 다르다면은 서버는 컨텐츠 전체와 함께 평범한 HTTP 200 OK 응답을 클라이언트에게 보냅니다.
- 객체 삭제 : 만약 서버 객체가 삭제되었다면, 서버는 404 Not Found 응답을 돌려보내며 캐시는 사본을 삭제합니다.<br/>
<br/>

## 적중률
캐시가 **요청을 처리하는 비율**을 `캐시 적중률`, 혹은 `문서 적중률`이라고 부릅니다. 적중률은 0 ~ 1까지의 값으로 되어있지만, 흔히 퍼센트로 표현되기도 합니다. **0%**는 모든 요청이 캐시 부적중, **100%**는 모든 요청이 캐시 적중임을 의미합니다.<br/>
<br/>

## 바이트 적중률
모든 문서가 같은 크기가 아니기 때문에 특정 사람들은 `바이트 적중률`을 더 선호합니다.<br/>
<br/>

## 적중과 부적중의 구별
클라이언트가 응답이 캐시에서 왔는지 알아내는 한 가지 방법은 `Date 헤더`를 이용하는 것입니다. 응답의 Date 헤더값을 현재 시각과 비교하여, 응답의 생성일이 더 오래되었다면 클라이언트는 응답이 캐시된 것임을 알아낼 수 있습니다.<br/>
<br/>

# 캐시 토폴로지
캐시는 **한 명**의 사용자에게만 할당될 수도 있고 반대로 **수천 명**의 사용자들 간에 공유될 수도 있습니다.<br/>
<br/>

## 개인 전용 캐시 
`개인 전용 캐시`는 많은 에너지나 저장 공간을 필요로 하지 않으므로, **작고 저렴**할 수 있습니다. 웹 브라우저는 개인 전용 캐시를 내장하고 있으며 대부분의 브라우저는 자주 쓰이는 문서를 개인용 컴퓨터의 디스크나 메모리에 캐시해 놓고 사용자가 캐시 사이즈 및 설정을 수정할 수 있도록 합니다.<br/>
<br/>

## 공용 프락시 캐시
공용 캐시는 캐시 프락시 서버 혹은 더 흔히 `프락시 캐시`라고 불리는 특별한 종류의 공유된 프락시 서버입니다. 프락시 캐시는 로컬 캐시에서 문서를 제공하거나, 혹은 사용자의 입장에서 서버에 접근합니다. 공용 캐시에는 여러 사용자가 접근하기 때문에, 불필요한 트래픽을 줄일 수 있는 더 많은 기회가 있습니다.<br/>
<br/>

## 프락시 캐시 계층들
작은 캐시에서 캐시 부적중이 발생했을 때 더 큰 부모 캐시가 그 '걸러 남겨진' 트래픽을 처리하도록 하는 계층을 만드는 방식이 합리적입니다.<br/>
<br/>

## 캐시망, 컨텐츠 라우팅, 피어링
몇몇 네트워크 아키텍쳐는 단순한 캐시 계층 대신 복잡한 캐시망을 만들고 복잡한 방식으로 서로 대화하여 서로간의 커뮤니케이션 결정을 동적으로 내립니다. 이러한 한층 더 복잡한 캐시 사이의 관계는, 서로 다른 조직들이 상호 이득을 위해 그들의 캐시를 연결하여 서로를 찾아볼 수 있도록 해줍니다.<br/>
<br/>

